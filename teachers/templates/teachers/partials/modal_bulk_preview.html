<div class="space-y-4">
    <div class="flex items-center justify-between">
        <h3 class="text-lg font-bold">Import Preview</h3>
        <div class="flex gap-2">
            <span class="badge badge-success gap-1">
                {{ valid_count }} Valid
            </span>
            {% if error_count > 0 %}
            <span class="badge badge-error gap-1">
                {{ error_count }} Errors
            </span>
            {% endif %}
        </div>
    </div>

    {% if valid_rows %}
    <div class="overflow-x-auto max-h-[40vh] bg-base-100 border border-base-200 rounded-lg">
        <table class="table table-xs table-pin-rows">
            <thead>
                <tr>
                    <th>Line</th>
                    <th>Name</th>
                    <th>Staff ID</th>
                    <th>Gender</th>
                    <th>Invite</th>
                </tr>
            </thead>
            <tbody>
                {% for row in valid_rows %}
                <tr>
                    <td class="font-mono opacity-50">{{ row.row_num }}</td>
                    <td class="font-medium">{{ row.title }} {{ row.first_name }} {{ row.last_name }}</td>
                    <td>{{ row.staff_id }}</td>
                    <td>{{ row.gender }}</td>
                    <td>
                        {% if row.send_invitation %}
                        <span class="badge badge-info badge-xs" title="{{ row.email }}">
                            <i class="fa-solid fa-envelope text-[8px]"></i>
                        </span>
                        {% else %}
                        <span class="text-base-content/30">-</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    {% if all_errors %}
    <div class="alert alert-warning shadow-sm items-start">
        <i class="fa-solid fa-triangle-exclamation mt-1"></i>
        <div class="w-full">
            <h4 class="font-bold text-sm">Issues Found</h4>
            <div class="max-h-[15vh] overflow-y-auto mt-2 space-y-1">
                {% for err in all_errors %}
                <div class="text-xs bg-base-100/50 p-2 rounded">
                    <strong>Row {{ err.row }}:</strong> 
                    <span class="opacity-80">{{ err.errors|join:", " }}</span>
                </div>
                {% endfor %}
            </div>
            <p class="text-xs mt-2 font-medium">
                Note: Rows with errors will be skipped. Only valid rows will be imported.
            </p>
        </div>
    </div>
    {% endif %}

    {% if valid_count == 0 %}
    <div class="alert alert-error">
        <i class="fa-solid fa-circle-xmark"></i>
        <span>No valid records found to import. Please check your file.</span>
    </div>
    {% endif %}

    <div class="modal-action">
        <button type="button" 
                class="btn" 
                hx-get="{% url 'teachers:bulk_import' %}" 
                hx-target="#modal-bulk-content">
            Back
        </button>
        
        {% if valid_count > 0 %}
        <form method="post" action="{% url 'teachers:bulk_import_confirm' %}">
            {% csrf_token %}
            <button type="submit" 
                    class="btn btn-primary"
                    {% if error_count > 0 %}onclick="return confirm('Ignore {{ error_count }} errors and import {{ valid_count }} valid records?')"{% endif %}>
                <i class="fa-solid fa-check"></i>
                Import {{ valid_count }} Teachers
            </button>
        </form>
        {% endif %}
    </div>
</div>