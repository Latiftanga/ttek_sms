{% load core_tags %}

<!-- Promotion History Sidebar Card -->
<div id="card-promotion" class="card bg-base-100 shadow-sm border border-base-200">
    <div class="card-body p-4">
        <div class="flex items-center justify-between mb-3">
            <h3 class="font-bold text-sm uppercase tracking-wider text-base-content/60">
                Enrollment History
            </h3>
            <a href="{% url 'students:promotion' %}"
               hx-get="{% url 'students:promotion' %}"
               hx-target="#main-content"
               hx-push-url="true"
               class="btn btn-xs btn-ghost text-success">
                <i class="fa-solid fa-arrow-up-right-dots"></i>
            </a>
        </div>

        <!-- Stats Summary -->
        {% if promotion_stats %}
        <div class="grid grid-cols-3 gap-2 mb-3">
            <div class="text-center p-2 rounded bg-base-200/50">
                <div class="text-lg font-bold text-primary">{{ promotion_stats.active }}</div>
                <div class="text-xs text-base-content/60">Active</div>
            </div>
            <div class="text-center p-2 rounded bg-base-200/50">
                <div class="text-lg font-bold text-info">{{ promotion_stats.promoted }}</div>
                <div class="text-xs text-base-content/60">Promoted</div>
            </div>
            <div class="text-center p-2 rounded bg-base-200/50">
                <div class="text-lg font-bold text-success">{{ promotion_stats.graduated }}</div>
                <div class="text-xs text-base-content/60">Graduated</div>
            </div>
        </div>
        {% endif %}

        <!-- Recent Activity -->
        {% if incoming_enrollments or outgoing_enrollments %}
        <div class="space-y-2 max-h-48 overflow-y-auto">
            {% for enroll in outgoing_enrollments %}
            <div class="flex items-center gap-2 py-1 text-xs border-b border-base-200 last:border-0">
                <span class="badge badge-xs {% if enroll.status == 'graduated' %}badge-success{% else %}badge-info{% endif %}">
                    {% if enroll.status == 'graduated' %}
                    <i class="fa-solid fa-graduation-cap"></i>
                    {% else %}
                    <i class="fa-solid fa-arrow-up"></i>
                    {% endif %}
                </span>
                <span class="font-medium truncate flex-1">{{ enroll.student.first_name }}</span>
                <span class="text-base-content/50">
                    {% if enroll.status == 'graduated' %}
                    Graduated
                    {% else %}
                    &rarr; {{ enroll.class_assigned.name }}
                    {% endif %}
                </span>
            </div>
            {% endfor %}

            {% for enroll in incoming_enrollments %}
            {% if enroll.promoted_from %}
            <div class="flex items-center gap-2 py-1 text-xs border-b border-base-200 last:border-0">
                <span class="badge badge-xs badge-ghost">
                    <i class="fa-solid fa-arrow-down"></i>
                </span>
                <span class="font-medium truncate flex-1">{{ enroll.student.first_name }}</span>
                <span class="text-base-content/50">
                    from {{ enroll.promoted_from.class_assigned.name }}
                </span>
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-4 text-base-content/50">
            <i class="fa-solid fa-history text-xl mb-2"></i>
            <p class="text-xs">No promotion history yet</p>
        </div>
        {% endif %}

        {% if current_year %}
        <div class="text-xs text-base-content/40 mt-2 pt-2 border-t border-base-200 text-center">
            {{ current_year }}
        </div>
        {% endif %}
    </div>
</div>
