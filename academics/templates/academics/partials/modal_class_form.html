{% load core_tags %}
<div x-data="{ levelType: '{{ form.level_type.value|default:'' }}' }">
<h3 class="text-lg font-bold mb-3">{% if is_create %}Add{% else %}Edit{% endif %} Class</h3>
<form hx-post="{% if class %}{% url 'academics:class_edit' class.pk %}{% else %}{% url 'academics:class_create' %}{% endif %}"
      hx-target="closest .modal-box"
      hx-swap="innerHTML transition:true">
    {% csrf_token %}
    <div class="space-y-3">
        <!-- Row 1: Level Type, Level Number -->
        <div class="grid grid-cols-2 gap-2">
            <label class="select select-bordered w-full select-sm">
                <span class="label">Type</span>
                <select name="level_type" x-model="levelType" required>
                    {% for value, label in form.level_type.field.choices %}
                    <option value="{{ value }}" {% if form.level_type.value == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </label>
            {% floating_field form.level_number "Level" size="sm" %}
        </div>

        <!-- Row 2: Section, Capacity -->
        <div class="grid grid-cols-2 gap-2">
            {% floating_field form.section size="sm" %}
            {% floating_field form.capacity size="sm" %}
        </div>

        <!-- Row 3: Class Teacher -->
        {% floating_field form.class_teacher "Class Teacher" size="sm" %}

        <!-- Row 4: Attendance Type (radio) & Programme -->
        <div class="grid grid-cols-2 gap-2 items-start">
            <div>
                <span class="text-xs text-base-content/70 mb-1 block">Attendance</span>
                <div class="flex gap-4">
                    {% for value, label in form.attendance_type.field.choices %}
                    <label class="label cursor-pointer gap-1.5 p-0">
                        <input type="radio" name="attendance_type" value="{{ value }}" class="radio radio-sm radio-primary" {% if form.attendance_type.value == value %}checked{% endif %}>
                        <span class="label-text text-sm">{{ label }}</span>
                    </label>
                    {% endfor %}
                </div>
            </div>
            {% if form.programme %}
            <div x-show="levelType === 'shs'" x-collapse>
                {% floating_field form.programme size="sm" %}
            </div>
            {% endif %}
        </div>

        <!-- Active checkbox -->
        <label class="label cursor-pointer justify-start gap-2 py-0">
            <input type="checkbox" name="is_active" class="checkbox checkbox-sm checkbox-primary" {% if form.is_active.value %}checked{% endif %}>
            <span class="label-text text-sm">Active class</span>
        </label>
    </div>
    {% if form.errors %}
    <div class="alert alert-error mt-3 py-2 text-sm">
        <i class="fa-solid fa-exclamation-circle"></i>
        <ul class="list-disc list-inside">
            {% for field in form %}
                {% for error in field.errors %}
                <li>{{ field.label }}: {{ error }}</li>
                {% endfor %}
            {% endfor %}
            {% for error in form.non_field_errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    <div class="modal-action mt-4">
        <button type="button" class="btn btn-sm" onclick="this.closest('dialog').close()">Cancel</button>
        <button type="submit" class="btn btn-sm btn-primary">{% if is_create %}Create{% else %}Save{% endif %}</button>
    </div>
</form>
</div>
