{% extends "admin/base.html" %}
{% load i18n admin_urls %}

{% block title %}{% trans 'Confirm deletion' %} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumb_items %}
{% if opts %}
<li><a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a></li>
<li><a href="{% url opts|admin_urlname:'changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a></li>
{% endif %}
<li>{% trans 'Delete selected' %}</li>
{% endblock %}

{% block content_title %}
<div class="px-6 pt-2 pb-4">
    <h1 class="text-2xl font-bold text-error flex items-center gap-3">
        <i class="fa-solid fa-triangle-exclamation"></i>
        {% trans 'Confirm deletion' %}
    </h1>
</div>
{% endblock %}

{% block content %}
<div class="max-w-3xl">
    {% if perms_lacking %}
    <!-- Permission denied -->
    <div class="card bg-base-100 shadow-sm border border-error">
        <div class="card-body">
            <div class="alert alert-error">
                <i class="fa-solid fa-lock"></i>
                <div>
                    <h3 class="font-bold">{% trans 'Permission denied' %}</h3>
                    <p>{% trans "Deleting the selected objects would require deleting the following protected related objects:" %}</p>
                </div>
            </div>
            <ul class="list-disc list-inside mt-4 space-y-1 text-base-content/80">
                {% for obj in perms_lacking %}
                <li>{{ obj }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    {% elif protected %}
    <!-- Protected objects -->
    <div class="card bg-base-100 shadow-sm border border-warning">
        <div class="card-body">
            <div class="alert alert-warning">
                <i class="fa-solid fa-shield"></i>
                <div>
                    <h3 class="font-bold">{% trans 'Cannot delete' %}</h3>
                    <p>{% trans "Deleting the selected objects would require deleting the following protected related objects:" %}</p>
                </div>
            </div>
            <ul class="list-disc list-inside mt-4 space-y-1 text-base-content/80">
                {% for obj in protected %}
                <li>{{ obj }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    {% else %}
    <!-- Confirmation form -->
    <div class="card bg-base-100 shadow-sm border border-base-200">
        <div class="card-body">
            <div class="alert alert-warning mb-6">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <div>
                    <h3 class="font-bold">{% trans 'Are you sure?' %}</h3>
                    <p>{% blocktrans %}Are you sure you want to delete the selected {{ objects_name }}? All of the following objects and their related items will be deleted:{% endblocktrans %}</p>
                </div>
            </div>

            {% if queryset %}
            <div class="mb-6">
                <h3 class="font-medium mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-list text-base-content/50"></i>
                    {% trans 'Objects to be deleted:' %}
                </h3>
                <div class="bg-base-200/50 rounded-lg p-4 max-h-64 overflow-y-auto">
                    <ul class="space-y-1 text-sm">
                        {% for obj in queryset %}
                        <li class="flex items-start gap-2">
                            <i class="fa-solid fa-trash-can text-error text-xs mt-1"></i>
                            <span>{{ obj }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}

            {% if deletable_objects %}
            <div class="mb-6">
                <h3 class="font-medium mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-link-slash text-base-content/50"></i>
                    {% trans 'Related objects that will also be deleted:' %}
                </h3>
                <div class="bg-base-200/50 rounded-lg p-4 max-h-64 overflow-y-auto">
                    <ul class="nested-list space-y-1 text-sm">
                        {% for deleted_object in deletable_objects %}
                        <li class="flex items-start gap-2">
                            <i class="fa-solid fa-trash-can text-error text-xs mt-1"></i>
                            <span>{{ deleted_object }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}

            {% if model_count %}
            <div class="mb-6">
                <h3 class="font-medium mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-chart-bar text-base-content/50"></i>
                    {% trans 'Summary' %}
                </h3>
                <div class="overflow-x-auto">
                    <table class="table table-sm table-zebra">
                        <thead>
                            <tr>
                                <th>{% trans 'Object type' %}</th>
                                <th class="text-right">{% trans 'Count' %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for model, count in model_count.items %}
                            <tr>
                                <td>{{ model }}</td>
                                <td class="text-right font-mono">{{ count }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}

            <form method="post">
                {% csrf_token %}
                {{ form }}
                <input type="hidden" name="action" value="delete_selected">
                <input type="hidden" name="post" value="yes">
                {% for obj in queryset %}
                <input type="hidden" name="{{ action_checkbox_name }}" value="{{ obj.pk }}">
                {% endfor %}

                <div class="flex flex-wrap gap-3 justify-end">
                    <a href="{% url opts|admin_urlname:'changelist' %}" class="btn btn-ghost">
                        <i class="fa-solid fa-arrow-left mr-2"></i>
                        {% trans "No, take me back" %}
                    </a>
                    <button type="submit" class="btn btn-error">
                        <i class="fa-solid fa-trash-can mr-2"></i>
                        {% trans "Yes, I'm sure" %}
                    </button>
                </div>
            </form>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
