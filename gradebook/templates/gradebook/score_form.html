{% extends "core/base.html" %}
{% load core_tags %}

{% block title %}{{ class_obj.name }} - {{ subject.name }} - Score Entry - {{ block.super }}{% endblock %}

{% block content %}
<div id="score-form-container">
{% include "gradebook/partials/score_form.html" %}
</div>

<!-- Assignments Modal -->
<dialog id="modal_assignments" class="modal modal-middle">
    <div class="modal-box max-w-2xl">
        <form method="dialog">
            <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </form>
        <div id="assignments-container">
            <div class="flex justify-center py-8">
                <span class="loading loading-spinner loading-lg"></span>
            </div>
        </div>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>

<!-- Score Changes Modal -->
<dialog id="modal_changes" class="modal modal-middle">
    <div class="modal-box max-w-4xl">
        <form method="dialog">
            <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </form>
        <div id="changes-container">
            <div class="flex justify-center py-8">
                <span class="loading loading-spinner loading-lg"></span>
            </div>
        </div>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>

<!-- Score Import Modal -->
<dialog id="modal_import" class="modal modal-middle">
    <div class="modal-box max-w-4xl">
        <form method="dialog">
            <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </form>
        <h3 class="font-bold text-lg mb-4">Import Scores</h3>
        <form hx-post="{% url 'gradebook:import_upload' class_obj.pk subject.pk %}"
              hx-target="#score-form-container"
              hx-swap="innerHTML"
              hx-on::after-request="if(event.detail.successful) this.closest('dialog').close()"
              enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text">Select CSV or Excel file</span>
                </label>
                <input type="file" name="file" accept=".csv,.xlsx,.xls" class="file-input file-input-bordered w-full" required>
            </div>
            <div class="alert alert-info mb-4">
                <i class="fa-solid fa-info-circle"></i>
                <span class="text-sm">Download the template first to see the expected format.</span>
            </div>
            <div class="modal-action">
                <button type="button" class="btn btn-ghost" onclick="this.closest('dialog').close()">Cancel</button>
                <button type="submit" class="btn btn-primary">
                    <i class="fa-solid fa-upload"></i>
                    Import
                </button>
            </div>
        </form>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>
{% endblock %}
