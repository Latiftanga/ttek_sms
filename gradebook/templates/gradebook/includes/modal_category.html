{% load core_tags %}

<div class="max-w-lg">
    <h3 class="font-bold text-lg mb-1">
        {% if category %}Edit Category{% else %}Add Assessment Category{% endif %}
    </h3>
    <p class="text-sm text-base-content/60 mb-4">Define how grades are weighted and organized</p>

    {% if error %}
    <div class="alert alert-error mb-4 py-2 text-sm">
        <i class="fa-solid fa-circle-exclamation"></i>
        <span>{{ error }}</span>
    </div>
    {% endif %}

    <form method="post"
          hx-post="{% if category %}{% url 'gradebook:category_edit' category.pk %}{% else %}{% url 'gradebook:category_create' %}{% endif %}"
          hx-target="#modal-content"
          class="space-y-4">

        <!-- Section: Basic Info -->
        <div class="bg-base-200/30 rounded-lg p-4">
            <h4 class="text-xs font-semibold uppercase text-base-content/50 mb-3 flex items-center gap-2">
                <i class="fa-solid fa-tag"></i> Basic Information
            </h4>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                {% text_input "name" value=category.name label="Category Name" placeholder="e.g., Class Score" required=True size="sm" %}
                {% text_input "short_name" value=category.short_name label="Short Name" placeholder="e.g., CA" required=True size="sm" help_text="Max 10 chars" %}
            </div>
            <div class="grid grid-cols-3 gap-3 mt-3">
                <div class="form-control">
                    <label class="label py-1">
                        <span class="label-text text-xs font-medium">Type</span>
                    </label>
                    <select name="category_type" class="select select-bordered select-sm w-full">
                        {% for value, label in category_types %}
                        <option value="{{ value }}" {% if category.category_type == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                {% number_input "percentage" value=category.percentage|default:"30" label="Weight %" min=0 max=100 required=True size="sm" %}
                {% number_input "order" value=category.order|default:"0" label="Order" min=0 size="sm" %}
            </div>
        </div>

        <!-- Section: Assessment Guidelines -->
        <div class="bg-base-200/30 rounded-lg p-4">
            <h4 class="text-xs font-semibold uppercase text-base-content/50 mb-1 flex items-center gap-2">
                <i class="fa-solid fa-list-check"></i> Assessment Guidelines
            </h4>
            <p class="text-xs text-base-content/50 mb-3">Set expectations for assessments per subject per term</p>

            <div class="grid grid-cols-3 gap-3">
                {% number_input "expected_assessments" value=category.expected_assessments|default:"0" label="Expected" min=0 size="sm" %}
                {% number_input "min_assessments" value=category.min_assessments|default:"0" label="Minimum" min=0 size="sm" %}
                {% number_input "max_assessments" value=category.max_assessments|default:"0" label="Maximum" min=0 size="sm" %}
            </div>
            <p class="text-xs text-base-content/50 mt-2">
                <i class="fa-solid fa-info-circle mr-1"></i>
                Set to 0 to disable. Teachers see warnings if counts differ from expected.
            </p>
        </div>

        {% if category %}
        <!-- Section: Status -->
        <div class="bg-base-200/30 rounded-lg p-4">
            <h4 class="text-xs font-semibold uppercase text-base-content/50 mb-3 flex items-center gap-2">
                <i class="fa-solid fa-toggle-on"></i> Status
            </h4>
            {% checkbox_input "is_active" checked=category.is_active label="Category is active" size="sm" %}
        </div>
        {% endif %}

        <!-- Actions -->
        <div class="flex justify-end gap-2 pt-2">
            <button type="button" class="btn btn-ghost btn-sm" onclick="modal_gradebook.close()">Cancel</button>
            <button type="submit" class="btn btn-primary btn-sm">
                <i class="fa-solid fa-check"></i>
                {% if category %}Save Changes{% else %}Add Category{% endif %}
            </button>
        </div>
    </form>
</div>
