{% load core_tags %}

<h3 class="font-bold text-lg mb-4">
    {% if category %}Edit Category{% else %}Add Category{% endif %}
</h3>

{% if error %}
<div class="alert alert-error mb-4 py-2 text-sm">
    <i class="fa-solid fa-circle-exclamation"></i>
    <span>{{ error }}</span>
</div>
{% endif %}

<form method="post"
      hx-post="{% if category %}{% url 'gradebook:category_edit' category.pk %}{% else %}{% url 'gradebook:category_create' %}{% endif %}"
      hx-target="#modal-content">

    <div class="space-y-4">
        <!-- Basic Info -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            {% text_input "name" value=category.name label="Category Name" placeholder="e.g., Class Score" required=True size="sm" %}
            {% text_input "short_name" value=category.short_name label="Short Name" placeholder="e.g., CA" required=True size="sm" help_text="Max 10 chars" %}
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
            <div class="form-control">
                <label class="label py-1">
                    <span class="label-text text-sm">Category Type</span>
                </label>
                <select name="category_type" class="select select-bordered select-sm w-full">
                    {% for value, label in category_types %}
                    <option value="{{ value }}" {% if category.category_type == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
            {% number_input "percentage" value=category.percentage|default:"30" label="Weight %" min=0 max=100 required=True size="sm" %}
            {% number_input "order" value=category.order|default:"0" label="Display Order" min=0 size="sm" %}
        </div>

        <!-- Assessment Count Guidelines -->
        <div class="divider text-xs text-base-content/50 my-2">Assessment Count Guidelines</div>

        <p class="text-xs text-base-content/60 -mt-2">
            Set expectations for how many assessments teachers should create per subject per term.
        </p>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
            {% number_input "expected_assessments" value=category.expected_assessments|default:"0" label="Expected" min=0 size="sm" help_text="Recommended count (advisory)" %}
            {% number_input "min_assessments" value=category.min_assessments|default:"0" label="Minimum" min=0 size="sm" help_text="Required minimum (enforced)" %}
            {% number_input "max_assessments" value=category.max_assessments|default:"0" label="Maximum" min=0 size="sm" help_text="Maximum allowed (enforced)" %}
        </div>

        <div class="text-xs text-base-content/50 bg-base-200/50 rounded-lg p-2">
            <i class="fa-solid fa-info-circle mr-1"></i>
            Set to 0 to disable a constraint. When teachers create assessments, they'll see warnings if counts differ from expected values.
        </div>

        {% if category %}
        <div class="pt-2">
            {% checkbox_input "is_active" checked=category.is_active label="Active" size="sm" %}
        </div>
        {% endif %}
    </div>

    <div class="modal-action">
        <button type="button" class="btn btn-sm btn-ghost" onclick="modal_gradebook.close()">Cancel</button>
        <button type="submit" class="btn btn-sm btn-primary">
            {% if category %}Save{% else %}Add{% endif %}
        </button>
    </div>
</form>
