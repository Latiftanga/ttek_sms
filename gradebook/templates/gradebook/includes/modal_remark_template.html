<div class="modal modal-open">
    <div class="modal-box max-w-lg">
        <form hx-post="{% if mode == 'edit' %}{% url 'gradebook:remark_template_edit' template.pk %}{% else %}{% url 'gradebook:remark_template_create' %}{% endif %}"
              hx-swap="innerHTML"
              hx-target="#modal-container">
            <h3 class="font-bold text-lg flex items-center gap-2">
                <i class="fa-solid fa-wand-magic-sparkles text-secondary"></i>
                {% if mode == 'edit' %}Edit Template{% else %}New Template{% endif %}
            </h3>

            {% if error %}
            <div class="alert alert-error mt-4">
                <i class="fa-solid fa-exclamation-circle"></i>
                <span>{{ error }}</span>
            </div>
            {% endif %}

            <div class="form-control mt-4">
                <label class="label">
                    <span class="label-text font-medium">Category</span>
                </label>
                <select name="category" class="select select-bordered w-full">
                    {% for value, label in categories %}
                    <option value="{{ value }}"
                            {% if mode == 'edit' and template.category == value %}selected{% endif %}
                            {% if form_data.category == value %}selected{% endif %}>
                        {{ label }}
                    </option>
                    {% endfor %}
                </select>
                <label class="label">
                    <span class="label-text-alt text-base-content/50">
                        Templates are grouped by performance category
                    </span>
                </label>
            </div>

            <div class="form-control mt-4">
                <label class="label">
                    <span class="label-text font-medium">Remark Content</span>
                </label>
                <textarea name="content"
                          class="textarea textarea-bordered h-32"
                          placeholder="Enter the remark template text..."
                          required>{% if mode == 'edit' %}{{ template.content }}{% elif form_data %}{{ form_data.content }}{% endif %}</textarea>
                <label class="label">
                    <span class="label-text-alt text-base-content/50">
                        Placeholders: {student_name}, {average}, {position}
                    </span>
                </label>
            </div>

            <div class="form-control mt-4">
                <label class="label">
                    <span class="label-text font-medium">Display Order</span>
                </label>
                <input type="number"
                       name="order"
                       class="input input-bordered w-24"
                       value="{% if mode == 'edit' %}{{ template.order }}{% elif form_data %}{{ form_data.order }}{% else %}0{% endif %}"
                       min="0">
                <label class="label">
                    <span class="label-text-alt text-base-content/50">
                        Lower numbers appear first within category
                    </span>
                </label>
            </div>

            {% if mode == 'edit' %}
            <div class="form-control mt-4">
                <label class="label cursor-pointer justify-start gap-3">
                    <input type="checkbox"
                           name="is_active"
                           class="checkbox checkbox-primary"
                           {% if template.is_active %}checked{% endif %}>
                    <span class="label-text font-medium">Active</span>
                </label>
                <span class="text-xs text-base-content/50 ml-10">
                    Inactive templates won't appear for teachers
                </span>
            </div>
            {% endif %}

            <div class="modal-action">
                <button type="button"
                        onclick="document.getElementById('modal-container').innerHTML = ''"
                        class="btn btn-ghost">
                    Cancel
                </button>
                <button type="submit" class="btn btn-primary gap-2">
                    <i class="fa-solid fa-check"></i>
                    {% if mode == 'edit' %}Update{% else %}Create{% endif %}
                </button>
            </div>
        </form>
    </div>
    <div class="modal-backdrop bg-black/50"
         onclick="document.getElementById('modal-container').innerHTML = ''"></div>
</div>
