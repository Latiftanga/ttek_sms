<h3 class="font-bold text-lg mb-4">
    <i class="fa-solid fa-file-import text-primary"></i>
    Import Preview
</h3>

<p class="text-sm text-base-content/60 mb-4">
    {{ class_obj.name }} - {{ subject.name }}
</p>

{% if errors %}
<div class="alert alert-warning mb-4">
    <i class="fa-solid fa-triangle-exclamation"></i>
    <div>
        <div class="font-medium">{{ errors|length }} error(s) found</div>
        <div class="text-xs">Rows with errors will be skipped during import.</div>
    </div>
</div>

<div class="collapse collapse-arrow bg-base-200 mb-4">
    <input type="checkbox" />
    <div class="collapse-title text-sm font-medium">
        View error details
    </div>
    <div class="collapse-content">
        <ul class="text-xs space-y-1">
            {% for error in errors %}
            <li class="text-error">{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endif %}

<div class="stats stats-horizontal shadow mb-4 w-full">
    <div class="stat py-2 px-4">
        <div class="stat-title text-xs">Valid Scores</div>
        <div class="stat-value text-lg text-success">{{ total_scores }}</div>
    </div>
    <div class="stat py-2 px-4">
        <div class="stat-title text-xs">Rows with Errors</div>
        <div class="stat-value text-lg text-error">{{ errors|length }}</div>
    </div>
</div>

{% if preview_data %}
<div class="overflow-x-auto max-h-64">
    <table class="table table-xs table-pin-rows">
        <thead>
            <tr class="bg-base-200">
                <th class="sticky left-0 bg-base-200">Row</th>
                <th>Student ID</th>
                <th>Name</th>
                {% for assign in assignments %}
                <th class="text-center text-xs">{{ assign.assessment_category.short_name }}: {{ assign.name }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in preview_data %}
            <tr class="{% if row.has_error %}bg-error/10{% endif %}">
                <td class="sticky left-0 {% if row.has_error %}bg-error/10{% else %}bg-base-100{% endif %}">{{ row.row_num }}</td>
                <td class="{% if not row.student %}text-error font-medium{% endif %}">{{ row.student_id }}</td>
                <td>{{ row.student_name }}</td>
                {% for score in row.scores %}
                <td class="text-center {% if score.error %}text-error{% endif %}">
                    {% if score.error %}
                    <span class="tooltip tooltip-error" data-tip="{{ score.error }}">
                        {{ score.value }}
                    </span>
                    {% else %}
                    {{ score.value|default:'-' }}
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<div class="modal-action">
    <button type="button" class="btn btn-ghost" onclick="modal_import.close()">Cancel</button>
    {% if total_scores > 0 %}
    <button class="btn btn-primary"
            hx-post="{% url 'gradebook:import_confirm' class_obj.pk subject.pk %}"
            hx-target="#import-container"
            hx-swap="innerHTML">
        <i class="fa-solid fa-check"></i>
        Import {{ total_scores }} Score(s)
    </button>
    {% endif %}
</div>
