{% load core_tags %}

<div class="min-h-[calc(100vh-12rem)] flex flex-col">
    <!-- Display Django Messages -->
    {% if messages %}
    <div class="mb-4 space-y-2" id="wizard-alerts">
        {% for message in messages %}
        <div class="alert {% if message.tags == 'error' %}alert-error{% elif message.tags == 'success' %}alert-success{% elif message.tags == 'warning' %}alert-warning{% else %}alert-info{% endif %} transition-opacity duration-300">
            <i class="fa-solid {% if message.tags == 'error' %}fa-circle-exclamation{% elif message.tags == 'success' %}fa-circle-check{% elif message.tags == 'warning' %}fa-triangle-exclamation{% else %}fa-circle-info{% endif %}"></i>
            <span>{{ message }}</span>
        </div>
        {% endfor %}
    </div>
    <script>
    (function() {
        const alerts = document.getElementById('wizard-alerts');
        if (alerts) {
            setTimeout(() => {
                alerts.style.opacity = '0';
                setTimeout(() => alerts.remove(), 300);
            }, 5000);
        }
    })();
    </script>
    {% endif %}
    <!-- Simple Header -->
    <div class="flex items-center gap-2 sm:gap-3 mb-6">
        <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-lg bg-gradient-to-br from-primary to-secondary flex items-center justify-center shrink-0">
            <i class="fa-solid fa-wand-magic-sparkles text-white text-sm sm:text-base"></i>
        </div>
        <div class="flex-1 min-w-0">
            <h1 class="text-base sm:text-xl font-bold">Setup Wizard</h1>
            <p class="text-[10px] sm:text-xs text-base-content/60">Configure your school in {% if tenant and tenant and school.has_houses %}5{% else %}4{% endif %} steps</p>
        </div>
        <a href="{% url 'core:index' %}" hx-get="{% url 'core:index' %}" hx-target="#main-content" hx-push-url="true"
           class="btn btn-ghost btn-xs sm:btn-sm">
            <i class="fa-solid fa-xmark"></i>
            <span class="hidden sm:inline">Exit</span>
        </a>
    </div>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col lg:flex-row gap-6">
        <!-- Steps Sidebar -->
        <div class="lg:w-64 flex-shrink-0">
            <div class="card bg-base-100 shadow-sm border border-base-200 sticky top-4">
                <div class="card-body p-4">
                    <ul class="steps steps-vertical w-full text-sm">
                        <li class="step {% if has_academic_year %}step-success{% else %}step-primary{% endif %}"
                            data-content="{% if has_academic_year %}✓{% else %}1{% endif %}">
                            <span class="text-left">Academic Year</span>
                        </li>
                        <li class="step {% if has_terms %}step-success{% elif has_academic_year %}step-primary{% endif %}"
                            data-content="{% if has_terms %}✓{% else %}2{% endif %}">
                            <span class="text-left">{{ period_label }}s</span>
                        </li>
                        <li class="step {% if has_classes %}step-success{% elif has_terms %}step-primary{% endif %}"
                            data-content="{% if has_classes %}✓{% else %}3{% endif %}">
                            <span class="text-left">Classes</span>
                        </li>
                        {% if tenant and school.has_houses %}
                        <li class="step {% if has_houses %}step-success{% elif has_classes %}step-primary{% endif %}"
                            data-content="{% if has_houses %}✓{% else %}4{% endif %}">
                            <span class="text-left">Houses</span>
                        </li>
                        <li class="step {% if has_subjects %}step-success{% elif has_houses %}step-primary{% endif %}"
                            data-content="{% if has_subjects %}✓{% else %}5{% endif %}">
                            <span class="text-left">Curriculum</span>
                        </li>
                        {% else %}
                        <li class="step {% if has_subjects %}step-success{% elif has_classes %}step-primary{% endif %}"
                            data-content="{% if has_subjects %}✓{% else %}4{% endif %}">
                            <span class="text-left">Curriculum</span>
                        </li>
                        {% endif %}
                    </ul>

                    <!-- Progress -->
                    <div class="mt-4 pt-4 border-t border-base-200">
                        <div class="flex items-center justify-between text-xs mb-1">
                            <span class="text-base-content/60">Progress</span>
                            <span class="font-medium">
                                {% if tenant and school.has_houses %}
                                {% if has_subjects %}100{% elif has_houses %}80{% elif has_classes %}60{% elif has_terms %}40{% elif has_academic_year %}20{% else %}0{% endif %}%
                                {% else %}
                                {% if has_subjects %}100{% elif has_classes %}75{% elif has_terms %}50{% elif has_academic_year %}25{% else %}0{% endif %}%
                                {% endif %}
                            </span>
                        </div>
                        <div class="w-full bg-base-200 rounded-full h-1.5">
                            <div class="bg-primary h-1.5 rounded-full transition-all"
                                 style="width: {% if tenant and school.has_houses %}{% if has_subjects %}100{% elif has_houses %}80{% elif has_classes %}60{% elif has_terms %}40{% elif has_academic_year %}20{% else %}0{% endif %}{% else %}{% if has_subjects %}100{% elif has_classes %}75{% elif has_terms %}50{% elif has_academic_year %}25{% else %}0{% endif %}{% endif %}%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Step Content -->
        <div class="flex-1">
            {% if not has_academic_year %}
            <!-- Step 1: Academic Year -->
            <div class="card bg-base-100 shadow-sm border border-base-200">
                <div class="card-body p-6">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="badge badge-primary badge-sm">Step 1</span>
                    </div>
                    <h2 class="text-lg font-bold mb-1">Create Academic Year</h2>
                    <p class="text-sm text-base-content/60 mb-5">Define the timeframe for your school calendar.</p>

                    <form hx-post="{% url 'core:setup_wizard_academic_year' %}" hx-target="#main-content">
                        {% csrf_token %}
                        {% now "Y" as current_year %}
                        {% with next_year=current_year|add:"1" %}
                        <div class="space-y-4">
                            <div class="form-control">
                                <label class="label py-1"><span class="label-text">Academic Year Name</span></label>
                                <input type="text" name="name" value="{{ current_year }}/{{ next_year }} Academic Year"
                                       class="input input-bordered" placeholder="e.g., {{ current_year }}/{{ next_year }} Academic Year" required>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-control">
                                    <label class="label py-1"><span class="label-text">Start Date</span></label>
                                    <input type="date" name="start_date" value="{{ current_year }}-09-01" class="input input-bordered" required>
                                </div>
                                <div class="form-control">
                                    <label class="label py-1"><span class="label-text">End Date</span></label>
                                    <input type="date" name="end_date" value="{{ next_year }}-07-31" class="input input-bordered" required>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary w-full mt-2">
                                Continue <i class="fa-solid fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                        {% endwith %}
                    </form>
                </div>
            </div>

            {% elif not has_terms %}
            <!-- Step 2: Session Type & Terms -->
            <div class="card bg-base-100 shadow-sm border border-base-200">
                <div class="card-body p-6">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="badge badge-primary badge-sm">Step 2</span>
                    </div>
                    <h2 class="text-lg font-bold mb-1">Configure {{ period_label }}s</h2>
                    <p class="text-sm text-base-content/60 mb-5">Set up your academic periods.</p>

                    {% if education_system == 'both' %}
                    <!-- Session Type - only show for "both" education system -->
                    <div class="flex items-center gap-4 mb-5">
                        <span class="text-sm font-medium">Session Type:</span>
                        <label class="flex items-center gap-1.5 cursor-pointer">
                            <input type="radio" name="session_type" value="term" class="radio radio-primary radio-sm"
                                   {% if period_type == 'term' %}checked{% endif %}
                                   hx-post="{% url 'core:setup_wizard_session_type' %}"
                                   hx-target="#main-content">
                            <span class="text-sm">Terms</span>
                        </label>
                        <label class="flex items-center gap-1.5 cursor-pointer">
                            <input type="radio" name="session_type" value="semester" class="radio radio-primary radio-sm"
                                   {% if period_type == 'semester' %}checked{% endif %}
                                   hx-post="{% url 'core:setup_wizard_session_type' %}"
                                   hx-target="#main-content">
                            <span class="text-sm">Semesters</span>
                        </label>
                    </div>
                    {% endif %}

                    <!-- Terms Form -->
                    <form hx-post="{% url 'core:setup_wizard_terms' %}" hx-target="#main-content">
                        {% csrf_token %}
                        <input type="hidden" name="term_count" value="{{ period_count }}">
                        <div class="space-y-4">
                            {% if period_type == 'semester' %}
                            {% for i in "12" %}
                            <div class="p-4 bg-base-200/50 rounded-lg">
                                <div class="font-medium text-sm mb-3">Semester {{ i }}</div>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                    <div class="form-control">
                                        <label class="label py-1"><span class="label-text text-xs">Name</span></label>
                                        <input type="text" name="term_{{ i }}_name" value="Semester {{ i }}"
                                               class="input input-bordered input-sm w-full" required>
                                    </div>
                                    <div class="form-control">
                                        <label class="label py-1"><span class="label-text text-xs">Start Date</span></label>
                                        <input type="date" name="term_{{ i }}_start" class="input input-bordered input-sm w-full" required>
                                    </div>
                                    <div class="form-control">
                                        <label class="label py-1"><span class="label-text text-xs">End Date</span></label>
                                        <input type="date" name="term_{{ i }}_end" class="input input-bordered input-sm w-full" required>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                            {% else %}
                            {% for i in "123" %}
                            <div class="p-4 bg-base-200/50 rounded-lg">
                                <div class="font-medium text-sm mb-3">Term {{ i }}</div>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                    <div class="form-control">
                                        <label class="label py-1"><span class="label-text text-xs">Name</span></label>
                                        <input type="text" name="term_{{ i }}_name" value="Term {{ i }}"
                                               class="input input-bordered input-sm w-full" required>
                                    </div>
                                    <div class="form-control">
                                        <label class="label py-1"><span class="label-text text-xs">Start Date</span></label>
                                        <input type="date" name="term_{{ i }}_start" class="input input-bordered input-sm w-full" required>
                                    </div>
                                    <div class="form-control">
                                        <label class="label py-1"><span class="label-text text-xs">End Date</span></label>
                                        <input type="date" name="term_{{ i }}_end" class="input input-bordered input-sm w-full" required>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                            {% endif %}
                        </div>
                        <div class="flex gap-2 mt-4">
                            <button hx-delete="{% url 'core:setup_wizard_clear_academic_year' %}" hx-target="#main-content"
                                    hx-confirm="This will delete the academic year and return to Step 1. Continue?" type="button" class="btn btn-ghost">
                                <i class="fa-solid fa-arrow-left"></i> Back
                            </button>
                            <button type="submit" class="btn btn-primary flex-1">
                                Continue <i class="fa-solid fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            {% elif not has_classes %}
            <!-- Step 3: Classes -->
            <div class="card bg-base-100 shadow-sm border border-base-200">
                <div class="card-body p-6">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="badge badge-primary badge-sm">Step 3</span>
                    </div>
                    <h2 class="text-lg font-bold mb-1">Create Classes</h2>
                    <p class="text-sm text-base-content/60 mb-4">Add classes your school offers.</p>

                    <!-- Classes Table -->
                    <div class="border border-base-300 rounded-lg mb-4">
                        <table class="table table-xs w-full">
                            <thead class="bg-base-200">
                                <tr>
                                    <th>Type</th>
                                    <th>Level</th>
                                    <th id="programme-header" class="hidden">Programme</th>
                                    <th>Section</th>
                                    <th class="text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody id="classes-list">
                                {% for cls in classes %}
                                <tr class="hover">
                                    <td>{{ cls.get_level_type_display }}</td>
                                    <td>{{ cls.level_number }}</td>
                                    <td class="programme-cell {% if cls.level_type != 'shs' %}hidden{% endif %}">{{ cls.programme.code|default:"-" }}</td>
                                    <td>{{ cls.section|default:"-" }}</td>
                                    <td class="text-right">
                                        <button hx-delete="{% url 'core:setup_wizard_remove_class' cls.pk %}"
                                                hx-target="closest tr"
                                                hx-swap="outerHTML"
                                                class="btn btn-ghost btn-xs text-error">
                                            <i class="fa-solid fa-trash-can"></i>
                                        </button>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr id="no-classes-row">
                                    <td colspan="5" class="text-center text-base-content/40 py-4">No classes added yet</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            <tfoot class="bg-base-200/50">
                                <tr>
                                    <td colspan="5" class="p-2">
                                        <form hx-post="{% url 'core:setup_wizard_add_class' %}"
                                              hx-target="#classes-list"
                                              hx-swap="beforeend"
                                              hx-on::after-request="this.reset(); updateLevelNumbers(); document.getElementById('no-classes-row')?.remove()"
                                              class="flex flex-wrap gap-2">
                                            {% csrf_token %}
                                            <select name="level_type" id="level_type" class="select select-bordered select-xs flex-1 min-w-[70px]" required
                                                    onchange="updateLevelNumbers()">
                                                {% for value, label in allowed_level_types %}
                                                <option value="{{ value }}" {% if value == 'basic' or forloop.first %}selected{% endif %}>{{ label }}</option>
                                                {% endfor %}
                                            </select>
                                            <select name="level_number" id="level_number" class="select select-bordered select-xs w-14" required>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                            </select>
                                            <select name="programme" id="programme" class="select select-bordered select-xs flex-1 min-w-[80px] hidden">
                                                <option value="">Programme</option>
                                                {% for prog in programmes %}
                                                <option value="{{ prog.id }}">{{ prog.code }}</option>
                                                {% endfor %}
                                            </select>
                                            <input type="text" name="section" class="input input-bordered input-xs flex-1 min-w-[60px]" placeholder="Section">
                                            <button type="submit" class="btn btn-primary btn-xs">
                                                <i class="fa-solid fa-plus"></i> Add
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <script>
                    function updateLevelNumbers() {
                        const levelType = document.getElementById('level_type').value;
                        const levelNumber = document.getElementById('level_number');
                        const programmeSelect = document.getElementById('programme');
                        const programmeHeader = document.getElementById('programme-header');
                        const programmeCells = document.querySelectorAll('.programme-cell');
                        const counts = { creche: 2, kg: 2, basic: 9, shs: 3 };
                        const max = counts[levelType] || 3;

                        // Update level numbers
                        levelNumber.innerHTML = '';
                        for (let i = 1; i <= max; i++) {
                            const opt = document.createElement('option');
                            opt.value = i;
                            opt.textContent = i;
                            levelNumber.appendChild(opt);
                        }

                        // Show/hide programme field for SHS
                        if (levelType === 'shs') {
                            programmeSelect.classList.remove('hidden');
                            programmeSelect.required = true;
                            programmeHeader.classList.remove('hidden');
                            programmeCells.forEach(c => c.classList.remove('hidden'));
                        } else {
                            programmeSelect.classList.add('hidden');
                            programmeSelect.required = false;
                            programmeSelect.value = '';
                            programmeHeader.classList.add('hidden');
                            programmeCells.forEach(c => c.classList.add('hidden'));
                        }
                    }
                    </script>

                    <!-- Quick Add Buttons -->
                    <div class="flex flex-wrap items-center gap-2 mb-4">
                        <span class="text-xs text-base-content/50">Quick add:</span>
                        {% for value, label in allowed_level_types %}
                        {% if value == 'creche' %}
                        <button hx-post="{% url 'core:setup_wizard_bulk_classes' %}?type=creche"
                                hx-target="#classes-list"
                                hx-swap="beforeend"
                                hx-on::after-request="document.getElementById('no-classes-row')?.remove()"
                                class="btn btn-xs btn-outline">Creche 1-2</button>
                        {% elif value == 'nursery' %}
                        <button hx-post="{% url 'core:setup_wizard_bulk_classes' %}?type=nursery"
                                hx-target="#classes-list"
                                hx-swap="beforeend"
                                hx-on::after-request="document.getElementById('no-classes-row')?.remove()"
                                class="btn btn-xs btn-outline">Nursery 1-2</button>
                        {% elif value == 'kg' %}
                        <button hx-post="{% url 'core:setup_wizard_bulk_classes' %}?type=kg"
                                hx-target="#classes-list"
                                hx-swap="beforeend"
                                hx-on::after-request="document.getElementById('no-classes-row')?.remove()"
                                class="btn btn-xs btn-outline">KG 1-2</button>
                        {% elif value == 'basic' %}
                        <button hx-post="{% url 'core:setup_wizard_bulk_classes' %}?type=basic"
                                hx-target="#classes-list"
                                hx-swap="beforeend"
                                hx-on::after-request="document.getElementById('no-classes-row')?.remove()"
                                class="btn btn-xs btn-outline">Basic 1-9</button>
                        {% elif value == 'shs' %}
                        <button hx-post="{% url 'core:setup_wizard_bulk_classes' %}?type=shs"
                                hx-target="#classes-list"
                                hx-swap="beforeend"
                                hx-on::after-request="document.getElementById('no-classes-row')?.remove()"
                                class="btn btn-xs btn-outline">SHS 1-3</button>
                        {% endif %}
                        {% endfor %}
                        <span class="text-base-content/30">|</span>
                        <button hx-delete="{% url 'core:setup_wizard_clear_classes' %}"
                                hx-target="#main-content"
                                hx-confirm="Clear all classes?"
                                class="btn btn-xs btn-ghost text-error">Clear All</button>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="flex gap-2">
                        <button hx-delete="{% url 'core:setup_wizard_clear_terms' %}" hx-target="#main-content"
                                hx-confirm="This will delete terms and return to Step 2. Continue?" type="button" class="btn btn-ghost">
                            <i class="fa-solid fa-arrow-left"></i> Back
                        </button>
                        <a hx-get="{% url 'core:setup_wizard' %}" hx-target="#main-content" class="btn btn-primary flex-1">
                            Continue <i class="fa-solid fa-arrow-right ml-1"></i>
                        </a>
                    </div>
                </div>
            </div>

            {% elif not has_houses and tenant and school.has_houses %}
            <!-- Step 4: Houses (only for basic schools) -->
            <div class="card bg-base-100 shadow-sm border border-base-200">
                <div class="card-body p-6">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="badge badge-primary badge-sm">Step 4</span>
                        <span class="badge badge-ghost badge-sm">Optional</span>
                    </div>
                    <h2 class="text-lg font-bold mb-1">Create Houses</h2>
                    <p class="text-sm text-base-content/60 mb-4">Organize students into groups for competitions.</p>

                    <!-- Houses Table -->
                    <div class="border border-base-300 rounded-lg mb-4">
                        <table class="table table-xs w-full">
                            <thead class="bg-base-200">
                                <tr>
                                    <th>Color</th>
                                    <th>House Name</th>
                                    <th class="text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody id="houses-list">
                                {% for house in houses %}
                                <tr class="hover">
                                    <td>
                                        <span class="w-5 h-5 rounded-full inline-block border border-base-300" style="background-color: {{ house.color_code }};"></span>
                                    </td>
                                    <td>{{ house.name }}</td>
                                    <td class="text-right">
                                        <button hx-delete="{% url 'core:setup_wizard_remove_house' house.pk %}"
                                                hx-target="closest tr"
                                                hx-swap="outerHTML"
                                                class="btn btn-ghost btn-xs text-error">
                                            <i class="fa-solid fa-trash-can"></i>
                                        </button>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr id="no-houses-row">
                                    <td colspan="3" class="text-center text-base-content/40 py-4">No houses added yet</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            <tfoot class="bg-base-200/50">
                                <tr>
                                    <td colspan="3" class="p-2">
                                        <form hx-post="{% url 'core:setup_wizard_add_house' %}"
                                              hx-target="#houses-list"
                                              hx-swap="beforeend"
                                              hx-on::after-request="this.reset(); document.getElementById('no-houses-row')?.remove()"
                                              class="flex flex-wrap gap-2">
                                            {% csrf_token %}
                                            <input type="color" name="color_code" value="#ef4444" class="w-7 h-7 rounded cursor-pointer border border-base-300 shrink-0">
                                            <input type="text" name="name" class="input input-bordered input-xs flex-1 min-w-[100px]" placeholder="House name" required>
                                            <button type="submit" class="btn btn-primary btn-xs">
                                                <i class="fa-solid fa-plus"></i> Add
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                    <!-- Quick Actions -->
                    <div class="flex flex-wrap items-center gap-2 mb-4">
                        <button hx-delete="{% url 'core:setup_wizard_clear_houses' %}"
                                hx-target="#main-content"
                                hx-confirm="Clear all houses?"
                                class="btn btn-xs btn-ghost text-error">
                            <i class="fa-solid fa-trash-can mr-1"></i> Clear All
                        </button>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="flex gap-2">
                        <button hx-delete="{% url 'core:setup_wizard_clear_classes' %}" hx-target="#main-content"
                                hx-confirm="This will delete classes and return to Step 3. Continue?" type="button" class="btn btn-ghost">
                            <i class="fa-solid fa-arrow-left"></i> Back
                        </button>
                        <a hx-get="{% url 'core:setup_wizard' %}?skip_houses=1" hx-target="#main-content" class="btn btn-primary flex-1">
                            Continue <i class="fa-solid fa-arrow-right ml-1"></i>
                        </a>
                    </div>
                </div>
            </div>

            {% elif not has_subjects %}
            <!-- Step 4/5: Import Curriculum -->
            <div class="card bg-base-100 shadow-sm border border-base-200">
                <div class="card-body p-6">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="badge badge-primary badge-sm">Step {% if tenant and school.has_houses %}5{% else %}4{% endif %}</span>
                    </div>
                    <h2 class="text-lg font-bold mb-1">Import Curriculum</h2>
                    <p class="text-sm text-base-content/60 mb-5">Import Ghana's standard curriculum data.</p>

                    <div class="grid grid-cols-{% if tenant and school.has_programmes %}4{% else %}3{% endif %} gap-3 mb-5">
                        {% if tenant and school.has_programmes %}
                        <div class="p-3 bg-base-200/50 rounded-lg text-center">
                            <div class="text-xl font-bold text-primary">7</div>
                            <div class="text-xs text-base-content/60">Programmes</div>
                        </div>
                        {% endif %}
                        <div class="p-3 bg-base-200/50 rounded-lg text-center">
                            <div class="text-xl font-bold text-primary">47</div>
                            <div class="text-xs text-base-content/60">Subjects</div>
                        </div>
                        <div class="p-3 bg-base-200/50 rounded-lg text-center">
                            <div class="text-xl font-bold text-primary">11</div>
                            <div class="text-xs text-base-content/60">Periods</div>
                        </div>
                        <div class="p-3 bg-base-200/50 rounded-lg text-center">
                            <div class="text-xl font-bold text-primary">2</div>
                            <div class="text-xs text-base-content/60">Grading</div>
                        </div>
                    </div>

                    <form hx-post="{% url 'core:setup_wizard_seed' %}" hx-target="#main-content">
                        {% csrf_token %}
                        <input type="hidden" name="seed_type" value="all">
                        <div class="flex gap-2">
                            {% if tenant and school.has_houses %}
                            <button hx-delete="{% url 'core:setup_wizard_clear_houses' %}" hx-target="#main-content"
                                    hx-confirm="This will delete houses and return to Step 4. Continue?" type="button" class="btn btn-ghost">
                                <i class="fa-solid fa-arrow-left"></i> Back
                            </button>
                            {% else %}
                            <button hx-delete="{% url 'core:setup_wizard_clear_classes' %}" hx-target="#main-content"
                                    hx-confirm="This will delete classes and return to Step 3. Continue?" type="button" class="btn btn-ghost">
                                <i class="fa-solid fa-arrow-left"></i> Back
                            </button>
                            {% endif %}
                            <button type="submit" class="btn btn-primary flex-1">
                                <i class="fa-solid fa-download mr-1"></i> Import Curriculum
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            {% else %}
            <!-- Setup Complete -->
            <div class="card bg-base-100 shadow-sm border border-success/30">
                <div class="card-body p-8 text-center">
                    <div class="w-16 h-16 rounded-full bg-success/10 flex items-center justify-center mx-auto mb-4">
                        <i class="fa-solid fa-check text-success text-2xl"></i>
                    </div>
                    <h2 class="text-xl font-bold text-success mb-2">Setup Complete!</h2>
                    <p class="text-base-content/60 mb-6">Your school is ready to use.</p>

                    <div class="grid grid-cols-4 gap-3 mb-6 max-w-md mx-auto">
                        <div class="p-2 bg-base-200/50 rounded-lg text-center">
                            <div class="text-lg font-bold">{{ academic_years|length }}</div>
                            <div class="text-xs text-base-content/60">Year</div>
                        </div>
                        <div class="p-2 bg-base-200/50 rounded-lg text-center">
                            <div class="text-lg font-bold">{{ terms|length }}</div>
                            <div class="text-xs text-base-content/60">{{ period_label }}s</div>
                        </div>
                        <div class="p-2 bg-base-200/50 rounded-lg text-center">
                            <div class="text-lg font-bold">{{ classes|length }}</div>
                            <div class="text-xs text-base-content/60">Classes</div>
                        </div>
                        <div class="p-2 bg-base-200/50 rounded-lg text-center">
                            <div class="text-lg font-bold">{{ houses|length }}</div>
                            <div class="text-xs text-base-content/60">Houses</div>
                        </div>
                    </div>

                    <form hx-post="{% url 'core:setup_wizard_complete' %}" hx-target="#main-content" hx-push-url="{% url 'core:index' %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success">
                            <i class="fa-solid fa-rocket mr-1"></i> Launch Dashboard
                        </button>
                    </form>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
