<div id="card-email" class="card bg-base-100 shadow-sm border border-base-200 h-full overflow-hidden">
    <!-- Branded top accent -->
    <div class="h-1 school-gradient-subtle"></div>
    <div class="card-body p-4">
        <div class="flex items-center justify-between mb-3">
            <h3 class="font-semibold flex items-center gap-2">
                <div class="w-7 h-7 rounded-lg school-gradient flex items-center justify-center">
                    <i class="fa-solid fa-envelope text-white text-xs"></i>
                </div>
                Email Configuration
            </h3>
            <button class="btn btn-ghost btn-xs" onclick="modal_email_settings.showModal()">
                <i class="fa-solid fa-pen text-xs"></i>
            </button>
        </div>

        {% if errors %}
        <div id="email-alert" class="mb-3 p-2 bg-error/10 rounded-lg border border-error/30 transition-opacity duration-500">
            <ul class="text-xs text-error space-y-1">
                {% for error in errors %}
                <li class="flex items-center gap-1">
                    <i class="fa-solid fa-circle-exclamation"></i>
                    {{ error }}
                </li>
                {% endfor %}
            </ul>
        </div>
        <script>setTimeout(() => { const el = document.getElementById('email-alert'); if(el) { el.style.opacity = '0'; setTimeout(() => el.remove(), 500); } }, 5000);</script>
        {% elif success %}
        <div id="email-alert" class="mb-3 transition-opacity duration-500">
            {% include "core/partials/alert.html" with type="success" message=success %}
        </div>
        <script>setTimeout(() => { const el = document.getElementById('email-alert'); if(el) { el.style.opacity = '0'; setTimeout(() => el.remove(), 500); } }, 3000);</script>
        {% endif %}

        <div class="space-y-2 text-sm">
            <div class="flex justify-between items-center">
                <span class="text-base-content/60">Status</span>
                {% if school_settings.email_enabled %}
                <span class="badge badge-success badge-sm gap-1">
                    <i class="fa-solid fa-circle text-[6px]"></i>
                    Enabled
                </span>
                {% else %}
                <span class="badge badge-ghost badge-sm gap-1">
                    <i class="fa-solid fa-circle text-[6px]"></i>
                    Using Global
                </span>
                {% endif %}
            </div>
            <div class="flex justify-between">
                <span class="text-base-content/60">Provider</span>
                <span class="font-medium">{{ school_settings.get_email_backend_display }}</span>
            </div>
            {% if school_settings.email_enabled and school_settings.email_backend == 'smtp' %}
            <div class="flex justify-between">
                <span class="text-base-content/60">SMTP Host</span>
                <span class="font-medium font-mono text-xs">
                    {% if school_settings.email_host %}
                        {{ school_settings.email_host }}:{{ school_settings.email_port }}
                    {% else %}
                        <span class="text-warning">Not configured</span>
                    {% endif %}
                </span>
            </div>
            {% endif %}
            <div class="flex justify-between">
                <span class="text-base-content/60">From Address</span>
                <span class="font-medium text-xs">
                    {% if school_settings.email_from_address %}
                        {{ school_settings.email_from_address }}
                    {% else %}
                        <span class="text-base-content/40">(uses default)</span>
                    {% endif %}
                </span>
            </div>
        </div>

        {% if school_settings.email_enabled and school_settings.email_backend == 'smtp' and not school_settings.email_host %}
        <div class="mt-3 p-2 bg-warning/10 rounded-lg border border-warning/30">
            <p class="text-xs text-warning flex items-center gap-1">
                <i class="fa-solid fa-triangle-exclamation"></i>
                Email enabled but SMTP host not configured
            </p>
        </div>
        {% endif %}
    </div>
</div>
