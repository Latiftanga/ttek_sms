{% load core_tags %}

<!-- Page Header -->
<div class="flex items-center justify-between gap-2 mb-4">
    <div class="flex items-center gap-2 min-w-0">
        <a href="{% url 'core:my_grading' %}"
           hx-get="{% url 'core:my_grading' %}"
           hx-target="#main-content"
           hx-push-url="true"
           hx-swap="innerHTML show:window:top"
           class="btn btn-ghost btn-sm btn-circle shrink-0">
            <i class="fa-solid fa-arrow-left"></i>
        </a>
        <div class="min-w-0">
            <h1 class="text-lg font-bold truncate">{{ subject.name }}</h1>
            <p class="text-xs text-base-content/60">{{ class_obj.name }}</p>
        </div>
    </div>
    <div class="flex items-center gap-1 shrink-0">
        {% if grades_locked %}
        <span class="badge badge-warning badge-sm gap-1">
            <i class="fa-solid fa-lock text-xs"></i>
            <span class="hidden sm:inline">Locked</span>
        </span>
        {% endif %}
        <label class="swap swap-rotate btn btn-ghost btn-sm btn-square" title="Toggle View">
            <input type="checkbox" id="view-toggle" onchange="toggleScoreView()" />
            <i class="swap-off fa-solid fa-table-cells"></i>
            <i class="swap-on fa-solid fa-id-card"></i>
        </label>
        {% if not grades_locked %}
        <button class="btn btn-ghost btn-sm btn-square"
                onclick="modal_assignments.showModal(); htmx.ajax('GET', '{% url 'gradebook:assignments' subject.pk %}', {target: '#assignments-container'})"
                title="Manage Assignments">
            <i class="fa-solid fa-cog"></i>
        </button>
        {% endif %}
        <div class="dropdown dropdown-end">
            <div tabindex="0" role="button" class="btn btn-ghost btn-sm btn-square" title="More options">
                <i class="fa-solid fa-ellipsis-v"></i>
            </div>
            <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-30 w-48 p-2 shadow-lg border border-base-200">
                <li><a href="{% url 'core:export_scores' class_obj.pk subject.pk %}"><i class="fa-solid fa-download text-success"></i> Export CSV</a></li>
                <li><a href="{% url 'core:export_scores' class_obj.pk subject.pk %}?format=xlsx"><i class="fa-solid fa-file-excel text-success"></i> Export Excel</a></li>
                {% if not grades_locked %}
                <li class="border-t border-base-200 mt-1 pt-1">
                    <button onclick="modal_import.showModal()"><i class="fa-solid fa-upload text-primary"></i> Import Scores</button>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>
</div>

<!-- Refreshable content area -->
<div id="score-entry-container"
     hx-get="{% url 'core:enter_scores' class_obj.pk subject.pk %}"
     hx-trigger="assignmentsChanged from:body"
     hx-select="#score-entry-container"
     hx-swap="outerHTML">

{% if grades_locked %}
<div class="alert alert-warning mb-4 py-2">
    <i class="fa-solid fa-lock"></i>
    <span class="text-sm">Grades locked - view only</span>
</div>
{% endif %}

{% if not assignments %}
<!-- No Assignments -->
<div class="card bg-base-100 shadow-sm border border-base-200">
    <div class="card-body py-8 text-center">
        <div class="w-14 h-14 mx-auto mb-3 rounded-full bg-warning/10 flex items-center justify-center">
            <i class="fa-solid fa-clipboard-list text-warning text-xl"></i>
        </div>
        <h3 class="font-semibold mb-2">No Assignments Yet</h3>
        <p class="text-sm text-base-content/60 mb-4">
            Create assignments (tests, quizzes) to start entering scores.
        </p>
        {% if not grades_locked %}
        <button class="btn btn-primary"
                onclick="modal_assignments.showModal(); htmx.ajax('GET', '{% url 'gradebook:assignments' subject.pk %}', {target: '#assignments-container'})">
            <i class="fa-solid fa-plus"></i>
            Create Assignments
        </button>
        {% endif %}
    </div>
</div>

{% elif not students %}
<!-- No Students -->
<div class="card bg-base-100 shadow-sm border border-base-200">
    <div class="card-body py-8 text-center">
        <div class="w-14 h-14 mx-auto mb-3 rounded-full bg-info/10 flex items-center justify-center">
            <i class="fa-solid fa-users-slash text-info text-xl"></i>
        </div>
        <h3 class="font-semibold mb-2">No Students</h3>
        <p class="text-sm text-base-content/60">No active students in this class.</p>
    </div>
</div>

{% else %}

<!-- Toolbar - Sticky (Card View) -->
<div class="sticky top-0 z-20 bg-base-100 -mx-4 px-4 py-2 border-b border-base-200 mb-4" id="card-view-controls">
    <!-- Navigation row - full width -->
    <div class="flex items-center">
        <button type="button" onclick="prevStudent()" class="btn btn-ghost btn-sm btn-square" id="prev-student-btn" title="Previous student">
            <i class="fa-solid fa-chevron-left"></i>
        </button>
        <div class="flex-1 text-center min-w-0">
            <p class="font-semibold truncate" id="current-student-name">{{ students.0.full_name }}</p>
            <p class="text-xs text-base-content/60" id="student-counter">1/{{ students|length }}</p>
        </div>
        <button type="button" onclick="nextStudent()" class="btn btn-ghost btn-sm btn-square" id="next-student-btn" title="Next student">
            <i class="fa-solid fa-chevron-right"></i>
        </button>
    </div>
</div>

<!-- CARD VIEW - One student at a time with all assignments (default view) -->
<div id="card-score-view">
    {% for student in students %}
    <div class="student-card {% if not forloop.first %}hidden{% endif %}" data-student-index="{{ forloop.counter0 }}" data-student-id="{{ student.id }}">
        <!-- Assignment Scores -->
        <div class="card bg-base-100 shadow-sm border border-base-200 mb-4">
            <div class="divide-y divide-base-200">
                {% for assignment in assignments %}
                <div class="flex items-center justify-between gap-3 p-4">
                    <div class="flex-1 min-w-0">
                        <p class="font-medium">{{ assignment.name }}</p>
                        <p class="text-xs text-base-content/60 mt-0.5">
                            <span class="badge badge-ghost badge-sm">{{ assignment.assessment_category.short_name }}</span>
                            <span class="ml-1">Max {{ assignment.points_possible }}</span>
                        </p>
                    </div>
                    <input type="number"
                           inputmode="decimal"
                           name="points"
                           value="{% with score=scores_dict|get_item:student.id|get_item:assignment.id %}{{ score|default:'' }}{% endwith %}"
                           min="0"
                           max="{{ assignment.points_possible }}"
                           step="0.5"
                           placeholder="--"
                           class="input input-bordered w-20 h-12 text-center text-lg font-bold score-input"
                           data-student="{{ student.id }}"
                           data-assignment="{{ assignment.id }}"
                           data-max="{{ assignment.points_possible }}"
                           {% if grades_locked %}disabled{% endif %}
                           hx-post="{% url 'gradebook:score_save' %}"
                           hx-trigger="change delay:500ms, blur"
                           hx-vals='{"student_id": "{{ student.id }}", "assignment_id": "{{ assignment.id }}"}'
                           hx-include="this"
                           hx-swap="none" />
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endfor %}

    <!-- Jump to Student - Below the card -->
    <div class="form-control">
        <label class="label">
            <span class="label-text text-xs">Jump to student</span>
        </label>
        <select id="student-selector" class="select select-bordered w-full" onchange="showStudent(parseInt(this.value))">
            {% for student in students %}
            <option value="{{ forloop.counter0 }}">{{ forloop.counter }}. {{ student.full_name }}</option>
            {% endfor %}
        </select>
    </div>
</div>

<!-- TABLE VIEW - Full grid (hidden by default, shown via toggle) -->
<div class="hidden" id="table-score-view">
    <div class="card bg-base-100 shadow-sm border border-base-200">
        <div class="card-body p-0">
            <!-- Category Legend -->
            <div class="flex flex-wrap items-center gap-3 p-3 border-b border-base-200 bg-base-200/30">
                <span class="text-xs font-medium">Categories:</span>
                {% for cat in categories %}
                <span class="badge badge-outline badge-xs gap-1">{{ cat.name|escape }} ({{ cat.percentage }}%)</span>
                {% endfor %}
            </div>

            <!-- Scores Table -->
            <div class="overflow-x-auto">
                <table class="table table-sm table-pin-rows table-pin-cols">
                    <thead>
                        <tr class="bg-base-200">
                            <th class="bg-base-200 z-20 min-w-[180px]">Student</th>
                            {% for assignment in assignments %}
                            <th class="text-center min-w-[70px]">
                                <div class="text-[10px] font-normal text-base-content/50">{{ assignment.assessment_category.short_name }}</div>
                                <div class="font-medium text-xs">{{ assignment.name }}</div>
                                <div class="text-[10px] text-base-content/50">/{{ assignment.points_possible }}</div>
                            </th>
                            {% endfor %}
                            <th class="text-center bg-base-200 min-w-[60px]">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for student in students %}
                        <tr class="hover">
                            <td class="bg-base-100 z-10">
                                <div class="flex items-center gap-2">
                                    <div class="avatar placeholder">
                                        <div class="w-7 h-7 rounded-full bg-base-300 text-base-content">
                                            {% if student.photo %}
                                            <img src="{{ student.photo.url }}" alt="" loading="lazy" />
                                            {% else %}
                                            <span class="text-[10px]">{{ student.first_name|slice:":1" }}{{ student.last_name|slice:":1" }}</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="text-xs">{{ student.full_name }}</div>
                                </div>
                            </td>
                            {% for assignment in assignments %}
                            <td class="text-center p-1">
                                {% with score=scores_dict|get_item:student.id|get_item:assignment.id %}
                                <input type="number"
                                       name="points"
                                       value="{{ score|default:'' }}"
                                       min="0"
                                       max="{{ assignment.points_possible }}"
                                       step="0.5"
                                       class="input input-bordered input-xs w-14 text-center score-input-desktop"
                                       data-student="{{ student.id }}"
                                       data-assignment="{{ assignment.id }}"
                                       data-max="{{ assignment.points_possible }}"
                                       {% if grades_locked %}disabled{% endif %}
                                       hx-post="{% url 'gradebook:score_save' %}"
                                       hx-trigger="change delay:300ms, blur"
                                       hx-vals='{"student_id": "{{ student.id }}", "assignment_id": "{{ assignment.id }}"}'
                                       hx-include="this"
                                       hx-swap="none" />
                                {% endwith %}
                            </td>
                            {% endfor %}
                            <td class="text-center bg-base-100 font-bold text-xs">
                                <span class="student-total" data-student="{{ student.id }}">-</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Auto-save indicator -->
<div class="mt-4 p-3 bg-base-200/50 rounded-lg text-center">
    <span class="text-xs text-base-content/60">
        <i class="fa-solid fa-circle-check text-success"></i>
        Scores save automatically
    </span>
</div>

<!-- Styles for score input feedback -->
<style>
.score-input.input-error, .score-input-desktop.input-error {
    border-color: oklch(var(--er)) !important;
    background-color: oklch(var(--er) / 0.1) !important;
    animation: shake-input 0.3s ease-in-out;
}
.score-input.input-success, .score-input-desktop.input-success {
    border-color: oklch(var(--su)) !important;
    background-color: oklch(var(--su) / 0.15) !important;
}
@keyframes shake-input {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-3px); }
    40% { transform: translateX(3px); }
    60% { transform: translateX(-3px); }
    80% { transform: translateX(3px); }
}
</style>

<!-- Error tooltip (fixed position, stays in viewport) -->
<div id="score-error-tooltip-teacher" class="fixed z-[100] hidden pointer-events-none">
    <div class="bg-error text-error-content text-xs rounded-lg shadow-lg px-3 py-2 max-w-52 pointer-events-auto">
        <div class="flex items-start gap-2">
            <i class="fa-solid fa-circle-exclamation mt-0.5 flex-shrink-0"></i>
            <div>
                <div class="font-semibold" id="tooltip-message-teacher"></div>
                <div class="text-error-content/80 mt-0.5 text-[11px]" id="tooltip-hint-teacher"></div>
            </div>
        </div>
    </div>
</div>

<!-- Toast for errors -->
<div id="score-toast-teacher" class="toast toast-top toast-end z-50" style="display: none;">
    <div class="alert alert-error">
        <span id="score-toast-message-teacher"></span>
    </div>
</div>

<script>
(function() {
    // Student navigation for card view
    window.currentStudentIndex = 0;
    window.totalStudents = {{ students|length }};
    window.studentNames = [{% for s in students %}"{{ s.full_name|escapejs }}"{% if not forloop.last %},{% endif %}{% endfor %}];
})();

// Show a specific student card
function showStudent(index) {
    if (index < 0 || index >= window.totalStudents) return;

    window.currentStudentIndex = index;

    // Hide all student cards, show selected
    document.querySelectorAll('#card-score-view .student-card').forEach(function(card, i) {
        if (i === index) {
            card.classList.remove('hidden');
        } else {
            card.classList.add('hidden');
        }
    });

    // Update the dropdown selector
    var selector = document.getElementById('student-selector');
    if (selector) selector.selectedIndex = index;

    updateStudentNavigation();
}

function prevStudent() {
    if (window.currentStudentIndex > 0) {
        showStudent(window.currentStudentIndex - 1);
    }
}

function nextStudent() {
    if (window.currentStudentIndex < window.totalStudents - 1) {
        showStudent(window.currentStudentIndex + 1);
    }
}

function updateStudentNavigation() {
    var nameEl = document.getElementById('current-student-name');
    var counterEl = document.getElementById('student-counter');
    var prevBtn = document.getElementById('prev-student-btn');
    var nextBtn = document.getElementById('next-student-btn');

    if (nameEl && window.studentNames) {
        nameEl.textContent = window.studentNames[window.currentStudentIndex];
    }

    if (counterEl) {
        counterEl.textContent = (window.currentStudentIndex + 1) + '/' + window.totalStudents;
    }

    if (prevBtn) {
        prevBtn.disabled = window.currentStudentIndex === 0;
        prevBtn.classList.toggle('btn-disabled', window.currentStudentIndex === 0);
    }

    if (nextBtn) {
        nextBtn.disabled = window.currentStudentIndex === window.totalStudents - 1;
        nextBtn.classList.toggle('btn-disabled', window.currentStudentIndex === window.totalStudents - 1);
    }
}

// View toggle - switch between card view and table view
function toggleScoreView() {
    var cardView = document.getElementById('card-score-view');
    var tableView = document.getElementById('table-score-view');
    var cardControls = document.getElementById('card-view-controls');
    var viewToggle = document.getElementById('view-toggle');

    if (!cardView || !tableView) return;

    var showTable = viewToggle ? viewToggle.checked : false;

    if (showTable) {
        // Switch to table view
        cardView.classList.add('hidden');
        tableView.classList.remove('hidden');
        if (cardControls) cardControls.classList.add('hidden');
        calculateTotals();
    } else {
        // Switch to card view
        tableView.classList.add('hidden');
        cardView.classList.remove('hidden');
        if (cardControls) cardControls.classList.remove('hidden');
    }
}

// Calculate totals for desktop
function calculateTotals() {
    // Exit if not on score entry page
    if (!document.getElementById('score-entry-container')) return;

    var students = {};
    document.querySelectorAll('.score-input-desktop').forEach(function(input) {
        var studentId = input.dataset.student;
        var value = parseFloat(input.value) || 0;
        if (!students[studentId]) students[studentId] = 0;
        students[studentId] += value;
    });
    document.querySelectorAll('.student-total').forEach(function(span) {
        var studentId = span.dataset.student;
        var total = students[studentId] || 0;
        span.textContent = total > 0 ? total.toFixed(1) : '-';
    });
}

// ============ Validation & Feedback System ============
var errorTooltipTimeout = null;
var typingDebounceTimer = null;

function showToastTeacher(message, type) {
    const toast = document.getElementById('score-toast-teacher');
    const msgEl = document.getElementById('score-toast-message-teacher');
    if (!toast || !msgEl) return;

    const alertEl = toast.querySelector('.alert');
    msgEl.textContent = message;
    alertEl.className = 'alert alert-' + (type === 'error' ? 'error' : 'success');
    toast.style.display = 'block';
    setTimeout(() => { toast.style.display = 'none'; }, type === 'error' ? 5000 : 2500);
}

function showErrorTooltipTeacher(input, message, hint) {
    const tooltip = document.getElementById('score-error-tooltip-teacher');
    const messageEl = document.getElementById('tooltip-message-teacher');
    const hintEl = document.getElementById('tooltip-hint-teacher');

    if (!tooltip) return;

    if (errorTooltipTimeout) clearTimeout(errorTooltipTimeout);

    messageEl.textContent = message;
    hintEl.textContent = hint || '';
    hintEl.style.display = hint ? 'block' : 'none';

    // Fixed positioning - relative to viewport
    const rect = input.getBoundingClientRect();
    const tooltipWidth = 210;
    const tooltipHeight = 60;
    const padding = 8;

    let top = rect.bottom + padding;
    let left = rect.left;

    if (top + tooltipHeight > window.innerHeight) {
        top = rect.top - tooltipHeight - padding;
    }
    if (left + tooltipWidth > window.innerWidth - padding) {
        left = window.innerWidth - tooltipWidth - padding;
    }
    if (left < padding) left = padding;
    if (top < padding) top = padding;

    tooltip.style.top = top + 'px';
    tooltip.style.left = left + 'px';
    tooltip.classList.remove('hidden');

    errorTooltipTimeout = setTimeout(() => {
        tooltip.classList.add('hidden');
    }, 4000);
}

function hideErrorTooltipTeacher() {
    const tooltip = document.getElementById('score-error-tooltip-teacher');
    if (tooltip) tooltip.classList.add('hidden');
}

function validateScoreTeacher(value, max) {
    if (value === "") return { valid: true };
    var num = parseFloat(value);
    if (isNaN(num)) return { valid: false, message: "Enter a valid number", hint: "Use digits only, like 85 or 85.5" };
    if (num < 0) return { valid: false, message: "Cannot be negative", hint: "Scores must be 0 or higher" };
    if (num > max) return { valid: false, message: "Maximum is " + max, hint: "Enter a value between 0 and " + max };
    var decimalPart = value.split(".")[1];
    if (decimalPart && decimalPart.length > 2) {
        return { valid: false, message: "Max 2 decimal places", hint: "Use at most 2 decimal places" };
    }
    return { valid: true };
}

// Visual feedback on save with validation
function setupInputFeedback() {
    // Exit if not on score entry page
    if (!document.getElementById('score-entry-container')) return;

    document.querySelectorAll('.score-input, .score-input-desktop').forEach(input => {
        // Skip if already initialized
        if (input.dataset.validationInit) return;
        input.dataset.validationInit = 'true';

        // Real-time validation while typing
        input.addEventListener('input', function() {
            const inputEl = this;
            const max = parseFloat(this.dataset.max);
            const value = this.value.trim();
            const validation = validateScoreTeacher(value, max);

            if (typingDebounceTimer) clearTimeout(typingDebounceTimer);

            if (!validation.valid && value !== '') {
                this.classList.add('input-error');
                // Show tooltip after brief delay (150ms) for snappy mobile feedback
                typingDebounceTimer = setTimeout(function() {
                    showErrorTooltipTeacher(inputEl, validation.message, validation.hint);
                }, 150);
            } else {
                this.classList.remove('input-error');
                hideErrorTooltipTeacher();
            }

            calculateTotals();
        });

        // Validate on blur before HTMX sends
        input.addEventListener('blur', function() {
            const max = parseFloat(this.dataset.max);
            const value = this.value.trim();
            const validation = validateScoreTeacher(value, max);

            if (!validation.valid && value !== '') {
                this.classList.add('input-error');
                showToastTeacher(validation.message, 'error');
                showErrorTooltipTeacher(this, validation.message, validation.hint);
                // Cancel HTMX by removing the trigger temporarily
                this.setAttribute('data-hx-trigger-backup', this.getAttribute('hx-trigger') || '');
                this.removeAttribute('hx-trigger');
                // Restore after a moment
                setTimeout(() => {
                    const backup = this.getAttribute('data-hx-trigger-backup');
                    if (backup) this.setAttribute('hx-trigger', backup);
                }, 100);
            }
        });
    });
}

// Intercept HTMX requests for validation
document.body.addEventListener('htmx:beforeRequest', function(evt) {
    const input = evt.detail.elt;
    if (!input.classList.contains('score-input') && !input.classList.contains('score-input-desktop')) return;

    const max = parseFloat(input.dataset.max);
    const value = input.value.trim();
    const validation = validateScoreTeacher(value, max);

    if (!validation.valid && value !== '') {
        evt.preventDefault();
        input.classList.add('input-error');
        showToastTeacher(validation.message, 'error');
        showErrorTooltipTeacher(input, validation.message, validation.hint);
    }
});

// HTMX feedback - handle both success and errors
document.body.addEventListener('htmx:afterRequest', function(evt) {
    const input = evt.detail.elt;
    if (!input.classList.contains('score-input') && !input.classList.contains('score-input-desktop')) return;

    if (evt.detail.successful) {
        // Check for error in HX-Trigger header
        const trigger = evt.detail.xhr.getResponseHeader('HX-Trigger');
        if (trigger) {
            try {
                const triggerData = JSON.parse(trigger);
                if (triggerData.scoreError) {
                    input.classList.add('input-error');
                    input.classList.remove('input-success');
                    showToastTeacher(triggerData.scoreError.message, 'error');
                    showErrorTooltipTeacher(input, triggerData.scoreError.message, triggerData.scoreError.hint);
                    if (triggerData.revertScore) {
                        input.value = triggerData.revertScore.value;
                    }
                    return;
                }
                if (triggerData.showToast && triggerData.showToast.type === 'error') {
                    input.classList.add('input-error');
                    showToastTeacher(triggerData.showToast.message, 'error');
                    return;
                }
            } catch(e) {}
        }

        // Success
        input.classList.remove('input-error');
        input.classList.add('input-success');
        setTimeout(() => input.classList.remove('input-success'), 800);
    } else {
        // Request failed
        input.classList.add('input-error');
        showToastTeacher('Failed to save score', 'error');
        setTimeout(() => input.classList.remove('input-error'), 2000);
    }
});

// Initialize immediately
setupInputFeedback();
calculateTotals();
updateStudentNavigation();

// Re-init after HTMX swaps
document.body.addEventListener('htmx:afterSwap', function() {
    if (document.getElementById('score-entry-container')) {
        setupInputFeedback();
        calculateTotals();
        updateStudentNavigation();
    }
});
</script>
{% endif %}
</div><!-- end score-entry-container -->


<!-- Assignments Modal -->
<dialog id="modal_assignments" class="modal modal-bottom sm:modal-middle">
    <div class="modal-box max-w-xl">
        <form method="dialog">
            <button class="btn btn-sm btn-circle btn-ghost absolute right-3 top-3">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </form>
        <div id="assignments-container">
            <div class="flex justify-center py-8">
                <span class="loading loading-spinner loading-lg"></span>
            </div>
        </div>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>

<!-- Import Scores Modal -->
<dialog id="modal_import" class="modal modal-bottom sm:modal-middle">
    <div class="modal-box">
        <form method="dialog">
            <button class="btn btn-sm btn-circle btn-ghost absolute right-3 top-3">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </form>
        <h3 class="text-lg font-bold mb-4">
            <i class="fa-solid fa-file-import text-primary"></i>
            Import Scores
        </h3>

        <div id="import-content">
            <div class="alert alert-info mb-4 text-sm">
                <i class="fa-solid fa-circle-info"></i>
                <div>
                    <p class="font-medium">How to import:</p>
                    <ol class="list-decimal list-inside mt-1 space-y-1">
                        <li>Export current scores first</li>
                        <li>Fill in scores in the file</li>
                        <li>Upload the completed file</li>
                    </ol>
                </div>
            </div>

            <form hx-post="{% url 'core:import_scores' class_obj.pk subject.pk %}"
                  hx-target="#import-content"
                  hx-swap="innerHTML"
                  hx-encoding="multipart/form-data">
                {% csrf_token %}
                <div class="form-control">
                    <input type="file"
                           name="file"
                           accept=".csv,.xlsx,.xls"
                           class="file-input file-input-bordered w-full"
                           required />
                    <label class="label">
                        <span class="label-text-alt">CSV or Excel file</span>
                    </label>
                </div>
                <div class="modal-action">
                    <button type="button" class="btn btn-ghost" onclick="modal_import.close()">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fa-solid fa-upload"></i>
                        Upload
                    </button>
                </div>
            </form>
        </div>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>
