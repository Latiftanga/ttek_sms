{% load core_tags %}

<!-- Page Header -->
<div class="flex items-center gap-2 sm:gap-3 mb-4">
    <a href="{% url 'core:index' %}"
       hx-get="{% url 'core:index' %}"
       hx-target="#main-content"
       hx-push-url="true"
       class="w-8 h-8 sm:w-10 sm:h-10 rounded-lg bg-gradient-to-br from-primary to-secondary flex items-center justify-center shrink-0"
       title="Back to Dashboard">
        <i class="fa-solid fa-arrow-left text-white text-sm sm:text-base"></i>
    </a>
    <div class="flex-1 min-w-0">
        <h1 class="text-base sm:text-xl font-bold">My Classes</h1>
        <p class="text-[10px] sm:text-xs text-base-content/60">{{ current_term.name|default:"Your classes and subjects" }}</p>
    </div>
</div>

<!-- Quick Stats -->
<div class="grid grid-cols-4 gap-2 mb-4">
    <div class="bg-primary/10 rounded-lg p-2 text-center">
        <div class="text-lg font-bold text-primary">{{ total_classes }}</div>
        <div class="text-[10px] text-base-content/60">Classes</div>
    </div>
    <div class="bg-secondary/10 rounded-lg p-2 text-center">
        <div class="text-lg font-bold text-secondary">{{ homeroom_count }}</div>
        <div class="text-[10px] text-base-content/60">Homeroom</div>
    </div>
    <div class="bg-success/10 rounded-lg p-2 text-center">
        <div class="text-lg font-bold text-success">{{ total_students }}</div>
        <div class="text-[10px] text-base-content/60">Students</div>
    </div>
    <div class="bg-info/10 rounded-lg p-2 text-center">
        <div class="text-lg font-bold text-info">{{ total_subjects }}</div>
        <div class="text-[10px] text-base-content/60">Subjects</div>
    </div>
</div>

<!-- Quick Actions - Prominent on mobile -->
<div class="grid grid-cols-3 gap-2 mb-4">
    <a href="{% url 'core:my_attendance' %}"
       hx-get="{% url 'core:my_attendance' %}"
       hx-target="#main-content"
       hx-push-url="true"
       class="btn btn-outline btn-success h-auto py-3 flex-col gap-1">
        <i class="fa-solid fa-clipboard-check text-lg"></i>
        <span class="text-xs">Attendance</span>
    </a>
    <a href="{% url 'core:my_grading' %}"
       hx-get="{% url 'core:my_grading' %}"
       hx-target="#main-content"
       hx-push-url="true"
       class="btn btn-outline btn-primary h-auto py-3 flex-col gap-1">
        <i class="fa-solid fa-pen-to-square text-lg"></i>
        <span class="text-xs">Grading</span>
    </a>
    <a href="{% url 'core:my_timetable' %}"
       hx-get="{% url 'core:my_timetable' %}"
       hx-target="#main-content"
       hx-push-url="true"
       class="btn btn-outline btn-info h-auto py-3 flex-col gap-1">
        <i class="fa-solid fa-calendar-days text-lg"></i>
        <span class="text-xs">Timetable</span>
    </a>
</div>

{% if not classes_data %}
<!-- No Classes -->
<div class="card bg-base-100 shadow-sm border border-base-200">
    <div class="card-body py-12 text-center">
        <div class="w-16 h-16 rounded-full bg-base-200 flex items-center justify-center mx-auto mb-4">
            <i class="fa-solid fa-chalkboard text-base-content/30 text-2xl"></i>
        </div>
        <h3 class="font-semibold mb-2">No Classes Assigned</h3>
        <p class="text-sm text-base-content/60 max-w-xs mx-auto">
            Contact your administrator to get class assignments.
        </p>
    </div>
</div>

{% else %}

<!-- Homeroom Classes -->
{% if homeroom_classes %}
<div class="mb-4">
    <h2 class="text-sm font-bold text-secondary mb-2 flex items-center gap-2">
        <i class="fa-solid fa-house-user"></i>
        Homeroom Classes
    </h2>
    <div class="space-y-2">
        {% for item in homeroom_classes %}
        <div class="card bg-base-100 shadow-sm border-l-4 border-l-secondary border border-base-200">
            <div class="card-body p-3">
                <div class="flex items-center gap-3">
                    <!-- Class Icon -->
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-secondary to-primary text-white flex items-center justify-center shrink-0">
                        <span class="font-bold">{{ item.class.name|slice:":2" }}</span>
                    </div>

                    <!-- Class Info -->
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2">
                            <h3 class="font-bold truncate">{{ item.class.name }}</h3>
                            <span class="badge badge-secondary badge-xs">Form Teacher</span>
                        </div>
                        <p class="text-xs text-base-content/60 mt-0.5">
                            <i class="fa-solid fa-users mr-1"></i>{{ item.student_count }} students
                            {% if item.subjects %}
                            <span class="mx-1">Â·</span>
                            <i class="fa-solid fa-book mr-1"></i>{{ item.subjects|length }} subjects
                            {% endif %}
                        </p>
                    </div>
                </div>

                <!-- Action Buttons - Large touch targets -->
                <div class="grid grid-cols-3 gap-2 mt-3">
                    <a href="{% url 'core:class_students' item.class.pk %}"
                       hx-get="{% url 'core:class_students' item.class.pk %}"
                       hx-target="#main-content"
                       hx-push-url="true"
                       class="btn btn-sm btn-primary gap-1">
                        <i class="fa-solid fa-users"></i>
                        <span class="text-xs">Students</span>
                    </a>
                    <a href="{% url 'core:take_attendance' item.class.pk %}"
                       hx-get="{% url 'core:take_attendance' item.class.pk %}"
                       hx-target="#main-content"
                       hx-push-url="true"
                       class="btn btn-sm btn-success btn-outline gap-1">
                        <i class="fa-solid fa-clipboard-check"></i>
                        <span class="text-xs">Attend</span>
                    </a>
                    <a href="{% url 'core:my_grading' %}"
                       hx-get="{% url 'core:my_grading' %}"
                       hx-target="#main-content"
                       hx-push-url="true"
                       class="btn btn-sm btn-outline gap-1">
                        <i class="fa-solid fa-pen"></i>
                        <span class="text-xs">Grade</span>
                    </a>
                </div>

                <!-- Subjects I teach in this class -->
                {% if item.subjects %}
                <div class="mt-2 pt-2 border-t border-base-200">
                    <p class="text-[10px] text-base-content/50 mb-1">You teach:</p>
                    <div class="flex flex-wrap gap-1">
                        {% for subj in item.subjects %}
                        <span class="badge badge-primary badge-xs">{{ subj.short_name|default:subj.name }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Subject Classes -->
{% if subject_classes %}
<div>
    <h2 class="text-sm font-bold text-primary mb-2 flex items-center gap-2">
        <i class="fa-solid fa-book-open"></i>
        Subject Classes
        <span class="badge badge-primary badge-xs">{{ subject_classes|length }}</span>
    </h2>
    <div class="space-y-2">
        {% for item in subject_classes %}
        <div class="card bg-base-100 shadow-sm border border-base-200">
            <div class="card-body p-3">
                <div class="flex items-center gap-3">
                    <!-- Class Icon -->
                    <div class="w-10 h-10 rounded-lg bg-primary/10 text-primary flex items-center justify-center shrink-0">
                        <span class="font-bold text-sm">{{ item.class.name|slice:":2" }}</span>
                    </div>

                    <!-- Class Info -->
                    <div class="flex-1 min-w-0">
                        <h3 class="font-bold text-sm truncate">{{ item.class.name }}</h3>
                        <p class="text-xs text-base-content/60">
                            <i class="fa-solid fa-users mr-1"></i>{{ item.student_count }} students
                        </p>
                    </div>

                    <!-- Quick Actions -->
                    <div class="flex gap-1">
                        <a href="{% url 'core:take_attendance' item.class.pk %}"
                           hx-get="{% url 'core:take_attendance' item.class.pk %}"
                           hx-target="#main-content"
                           hx-push-url="true"
                           class="btn btn-ghost btn-sm btn-square"
                           title="Take Attendance">
                            <i class="fa-solid fa-clipboard-check text-success"></i>
                        </a>
                        <a href="{% url 'core:my_grading' %}"
                           hx-get="{% url 'core:my_grading' %}"
                           hx-target="#main-content"
                           hx-push-url="true"
                           class="btn btn-ghost btn-sm btn-square"
                           title="Enter Grades">
                            <i class="fa-solid fa-pen text-primary"></i>
                        </a>
                    </div>
                </div>

                <!-- My Subjects -->
                {% if item.subjects %}
                <div class="mt-2 flex flex-wrap gap-1">
                    {% for subj in item.subjects %}
                    <span class="badge badge-primary badge-sm">{{ subj.short_name|default:subj.name }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% endif %}

<!-- Help - Collapsible -->
<div class="collapse collapse-arrow bg-base-200/50 mt-4 rounded-lg">
    <input type="checkbox" />
    <div class="collapse-title text-sm font-medium py-3">
        <i class="fa-solid fa-circle-question text-info mr-2"></i>
        Understanding your classes
    </div>
    <div class="collapse-content text-sm">
        <ul class="space-y-2 text-base-content/70">
            <li class="flex items-start gap-2">
                <span class="badge badge-secondary badge-xs mt-1">Form</span>
                <span>Homeroom classes - you are the form teacher and can manage students</span>
            </li>
            <li class="flex items-start gap-2">
                <span class="badge badge-primary badge-xs mt-1">Subject</span>
                <span>Subject classes - you teach specific subjects only</span>
            </li>
            <li class="flex items-start gap-2">
                <i class="fa-solid fa-lightbulb text-warning mt-0.5"></i>
                <span>Tap any class to take attendance or enter grades quickly</span>
            </li>
        </ul>
    </div>
</div>
