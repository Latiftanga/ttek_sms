{% load core_tags %}
<h3 class="font-bold text-lg mb-4">{{ action|default:"Assign" }} House Master</h3>

<form hx-post="{% url 'students:housemaster_assign' %}"
      hx-target="#main-content"
      hx-swap="innerHTML">
    {% csrf_token %}

    <div class="space-y-4">
        <!-- Teacher Selection -->
        <div class="form-control">
            <label class="label py-1">
                <span class="label-text text-xs font-medium">Teacher</span>
            </label>
            <select name="teacher" class="select select-bordered select-sm" required>
                <option value="">Select teacher...</option>
                {% for teacher in form.fields.teacher.queryset %}
                <option value="{{ teacher.pk }}" {% if form.teacher.value == teacher.pk|stringformat:"s" %}selected{% endif %}>
                    {{ teacher.get_title_display }} {{ teacher.full_name }}
                </option>
                {% endfor %}
            </select>
            {% if form.teacher.errors %}
            <label class="label py-0"><span class="label-text-alt text-error">{{ form.teacher.errors.0 }}</span></label>
            {% endif %}
        </div>

        <!-- House Selection -->
        <div class="form-control">
            <label class="label py-1">
                <span class="label-text text-xs font-medium">House</span>
            </label>
            <select name="house" class="select select-bordered select-sm" required>
                <option value="">Select house...</option>
                {% for house in form.fields.house.queryset %}
                <option value="{{ house.pk }}" {% if form.house.value == house.pk|stringformat:"s" %}selected{% endif %}>
                    {{ house.name }}
                </option>
                {% endfor %}
            </select>
            {% if form.house.errors %}
            <label class="label py-0"><span class="label-text-alt text-error">{{ form.house.errors.0 }}</span></label>
            {% endif %}
        </div>

        <!-- Academic Year -->
        <div class="form-control">
            <label class="label py-1">
                <span class="label-text text-xs font-medium">Academic Year</span>
            </label>
            <select name="academic_year" class="select select-bordered select-sm" required>
                {% for year in form.fields.academic_year.queryset %}
                <option value="{{ year.pk }}" {% if form.academic_year.value == year.pk|stringformat:"s" or year == form.fields.academic_year.initial %}selected{% endif %}>
                    {{ year.name }}
                </option>
                {% endfor %}
            </select>
            {% if form.academic_year.errors %}
            <label class="label py-0"><span class="label-text-alt text-error">{{ form.academic_year.errors.0 }}</span></label>
            {% endif %}
        </div>

        <!-- Senior Housemaster Toggle -->
        <label class="label cursor-pointer justify-start gap-3 bg-base-200 rounded-lg px-4 py-3">
            <input type="checkbox" name="is_senior" value="true" class="checkbox checkbox-primary checkbox-sm"
                   {% if form.is_senior.value %}checked{% endif %} />
            <div>
                <span class="label-text font-medium">Senior House Master</span>
                <p class="text-xs text-base-content/50">Can approve external exeats for all houses</p>
            </div>
        </label>
        {% if form.is_senior.errors %}
        <p class="text-xs text-error">{{ form.is_senior.errors.0 }}</p>
        {% endif %}
    </div>

    {% if form.non_field_errors %}
    <div class="alert alert-error py-2 mt-4">
        <i class="fa-solid fa-exclamation-circle"></i>
        <span class="text-sm">{{ form.non_field_errors.0 }}</span>
    </div>
    {% endif %}

    <div class="modal-action">
        <button type="button" class="btn btn-ghost" onclick="modal_housemaster.close()">Cancel</button>
        <button type="submit" class="btn btn-primary">
            <i class="fa-solid fa-check"></i> {{ action|default:"Assign" }}
        </button>
    </div>
</form>
