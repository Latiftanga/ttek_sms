{% load core_tags %}
<div>
    <!-- Header -->
    <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 rounded-full flex items-center justify-center text-white font-bold"
             style="background-color: {{ house.color_code|default:'#6b7280' }}">
            {{ house.name|slice:":1"|upper }}
        </div>
        <div>
            <h3 class="font-bold text-lg">Assign Housemaster</h3>
            <p class="text-sm text-base-content/60">{{ house.name }}{% if current_year %} &middot; {{ current_year.name }}{% endif %}</p>
        </div>
    </div>

    {% if current_assignment %}
    <div class="alert alert-info py-3 mb-4">
        <i class="fa-solid fa-user-tie"></i>
        <div>
            <p class="text-sm"><span class="font-medium">Currently assigned:</span> {{ current_assignment.teacher.full_name }}</p>
            {% if current_assignment.is_senior %}<span class="badge badge-primary badge-sm mt-1">Senior Housemaster</span>{% endif %}
        </div>
    </div>
    {% endif %}

    <form method="post"
          action="{% url 'students:house_assign_master' house.pk %}"
          hx-post="{% url 'students:house_assign_master' house.pk %}">
        {% csrf_token %}

        <div class="space-y-4">
            <!-- Teacher Selection -->
            <div class="form-control w-full">
                <label class="label">
                    <span class="label-text font-medium">Select Teacher <span class="text-error">*</span></span>
                </label>
                <select name="teacher" class="select select-bordered w-full" required>
                    <option value="">-- Choose a teacher --</option>
                    {% for teacher in teachers %}
                    <option value="{{ teacher.pk }}" {% if current_assignment and current_assignment.teacher_id == teacher.pk %}selected{% endif %}>
                        {{ teacher.get_title_display }} {{ teacher.full_name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Senior Housemaster Checkbox -->
            <div class="form-control">
                <label class="label cursor-pointer justify-start gap-4 bg-base-200/50 border border-base-300 rounded-lg p-4">
                    <input type="checkbox" name="is_senior" value="true" class="checkbox checkbox-primary"
                           {% if current_assignment and current_assignment.is_senior %}checked{% endif %} />
                    <div>
                        <span class="label-text font-medium">Senior Housemaster</span>
                        <p class="text-xs text-base-content/60 mt-0.5">Can approve external exeats for all houses</p>
                    </div>
                </label>
            </div>
        </div>

        <!-- Actions -->
        <div class="flex items-center {% if current_assignment %}justify-between{% else %}justify-end{% endif %} gap-2 mt-6 pt-4 border-t border-base-200">
            {% if current_assignment %}
            <button type="button" class="btn btn-ghost btn-sm text-error"
                    hx-post="{% url 'students:house_remove_master' house.pk %}"
                    hx-confirm="Remove {{ current_assignment.teacher.full_name|escapejs }} as housemaster?">
                <i class="fa-solid fa-user-minus"></i>
                Remove
            </button>
            {% endif %}
            <div class="flex gap-2">
                <button type="button" class="btn btn-ghost btn-sm" onclick="document.getElementById('modal_housemaster').close()">Cancel</button>
                <button type="submit" class="btn btn-primary btn-sm">
                    <i class="fa-solid fa-check"></i>
                    Assign
                </button>
            </div>
        </div>
    </form>
</div>
