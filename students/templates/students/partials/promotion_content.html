{% load core_tags %}
<div class="space-y-4">
    <!-- Page Header -->
    <div class="flex items-center gap-2 sm:gap-3">
        <a href="{{ back_url|default:'/students/' }}"
           hx-get="{{ back_url|default:'/students/' }}"
           hx-target="#main-content"
           hx-push-url="true"
           class="w-8 h-8 sm:w-10 sm:h-10 rounded-lg bg-gradient-to-br from-warning to-error flex items-center justify-center shrink-0"
           title="Back to Students">
            <i class="fa-solid fa-arrow-left text-white text-sm sm:text-base"></i>
        </a>
        <div class="flex-1 min-w-0">
            <h1 class="text-base sm:text-xl font-bold">Class Promotion</h1>
            <p class="text-[10px] sm:text-xs text-base-content/60">
                {{ current_year }} &rarr; {{ next_year|default:"?" }}
            </p>
        </div>
    </div>

    {% if error %}
    <div class="alert alert-error">
        <i class="fa-solid fa-exclamation-circle"></i>
        <span>{{ error }}</span>
    </div>
    {% elif not next_year %}
    <div class="alert alert-warning">
        <i class="fa-solid fa-exclamation-triangle"></i>
        <span>Please create the next academic year before processing promotions.</span>
    </div>
    {% else %}

    <!-- Class Selector -->
    <div class="card bg-base-100 shadow-sm border border-base-200">
        <div class="card-body p-4 sm:p-5">
            {% select_input "class_url" options=class_options label="Select class to promote" placeholder="Choose a class..." input_class="w-full" %}
        </div>
    </div>

    <!-- Student list loaded here via HTMX -->
    <div id="promotion-detail-area" class="transition-opacity duration-150"></div>

    <script>
    document.getElementById('id_class_url')?.addEventListener('change', function() {
        if (!this.value) return;
        const area = document.getElementById('promotion-detail-area');
        area.classList.add('opacity-0');
        htmx.ajax('GET', this.value, {target: '#promotion-detail-area', swap: 'innerHTML'}).then(() => {
            requestAnimationFrame(() => area.classList.remove('opacity-0'));
        });
    });
    </script>

    {% endif %}
</div>
